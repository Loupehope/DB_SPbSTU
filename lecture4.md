
- [Лекция 11](#11-Лекция)
- [Лекция 12](#12-Лекция)

# 11 Лекция

**Real Application Testing** - позволяет тестировать влияние изменений в базе данных:
– Модернизация базы данных (Database upgrades) 
– Реализация рекомендаций по настройке 
– Изменения в схеме (Schema changes)
– Сбор статистик (Statistics gathering)
- Изменения параметров базы данных
– Изменения операционной системы и оборудования

**Две функциональные компоненты Real Application Testing:**
- SQL Performance Analyzer - может быть использован для предсказания и предотвращения потенциальных проблем при любом изменении окружения базы данных, которое затрагивает структуру планов выполнения команд SQL.
- Database Replay - тестирует полную рабочую нагрузку, учитывая зависимость транзакций.

**SQL Tuning Set**:
 - это объект базы данных, который хранит одну или более SQL-команд вместе с их статистикой, состоянием выполнения и, возможно, с пользовательским ранжированием приоритетов.

**Stored outline**:
- это набор подсказок (hints) для команды SQL. Подсказки указывают оптимизатору выбор определенного плана выполнения для команды.

**SQL profile**:
– это объект базы данных, который содержит дополнительные статистики, специфичные для команд SQL. SQL profile создается при обращении DBA к SQL Tuning Advisor.

**SQL plan baseline**:
- это набор планов, позволяющих обеспечить оптимальную производительность.

**SQL plan management**:
– это механизм, позволяющий оптимизатору автоматически обслуживать планы выполнения, позволяя быть уверенными, что база данных использует только известные или проверенные планы.

**Процесс SQL Performance Analyzer:**:
1. Сбор (захват - capture) SQL нагрузки на продукционной системе.
2. Транспортировка SQL нагрузки на тестовую систему.
3. Определение производительности “before-change”.
4. Проведение изменений.
5. Определение производительности “after-change” performance data.
6. Сравнение результатов на шагах 3 и 5.
7. Настройка регрессировавших SQL.

**SQL Performance Analyzer предлагает три способа для тестирования различных сценариев:**
- **Optimizer Upgrade Simulation:** Тест определяет влияние изменения версии оптимизатора на производительность SQL Tuning set. Создается задача для SQL Performance Analyzer первый пробный запуск осуществляется с параметром optimizer_features_enable, установленным в исходное значение (например, 11.1.0.7). Второй пробный запуск производится с параметром optimizer_features_enable, установленным в целевое значение (например, 11.2.0.4). Затем создается отчет сравнения воспроизведения двух испытаний.
- **Parameter Change:** Тестирование и сравнение изменения параметров инициализации на производительность SQL tuning set.
- **Guided Workflow:** Создается задача SQL Performance Analyzer и выполняются пользовательские эксперименты с использованием созданных вручную воспроизведений испытаний.

**Per-SQL Time Limit** - определяет предельное время выполнения каждой команды SQL:
- UNLIMITED: Время выполнения SQL не ограничено.
- EXPLAIN ONLY: Генерируется только план выполнения задачи, задача не выполняется.
- CUSTOMIZE: Пользователь может сам установить предельное значение времени выполнения.

**Comparison Report**:
- Projected Workload: Эта диаграмма показывает прогнозируемую нагрузку для каждого воспроизведения испытания на основе метрики сравнения вместе с улучшением, ухудшением и общим воздействием.
- SQL Statement Count: Эта диаграмма показывает количество команд, которые улучшили, ухудшили или не изменили свою производительность.

# 12 Лекция

**Профили SQL (SQL profiles)** - предоставляют средства для управления производительностью команд при изменении факторов, влияющих на оптимизатор.  

**SQL Access Advisor** – это инструмент, помогающий выбрать изменения структуры данных путем воспроизведения рабочей нагрузки на текущей структуре и рекомендации изменений, которые обеспечат общую выгоду (overall benefit).

**Опорные линии планов SQL (SQL plan baselines)** – это ключевые объекты, которые технология SQL Plan Management использует для того, чтобы предотвратить непроверенные изменения в планах выполнения SQL. Когда опция SQL Plan Management активна, то не будет радикальных (drastic) изменений в производительности, даже если изменятся статистики или изменится версия базы данных. До тех пор пока при проверке не будет установлено, что новый план обеспечивает лучшую производительность, он не будет рассматриваться оптимизатором. Это в результате замораживает план SQL.

**SQL Plan Management автоматически управляет перестроением плана SQL:**
• Оптимизатор автоматически обслуживает опорные линии (baselines) планов SQL.
 – Используются только известные и проверенные планы. 
• План изменяется и автоматически проверяется.
 – Только сравнимые и лучшие планы впоследствии используются.
• Опорная линия плана может быть источником для критических SQL с SQL tuning set (STS) из SQL Performance Analyzer.

