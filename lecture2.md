# Лекиия 1
# Flashback

- Flashback query - запросы к старому состоянию таблицы в каком-то моменте времени.  
- Flashback version query - как изменялись данные в определненный момент времени - не используется для внешних, временных, sys таблицами и представлениями. Не может захватить интервал при наличии DDL команды и сжатие сегмента.        
- Flashback transaction query - изменения выполненные за транзакцию - DDL - изменения в системных таблицах.  
- Flashback transaction - восстановление данных по транзакции с учетом и без учета зависимостей.   

1. Уровень БД (Flashback log - flashback recovery area)
	- Можно восстановить бд на конкретный момент времени
	- По умолчанию выключена, так как ресуросемкая
2. Уровень таблицы 
	- Drop - восстановление таблицы и данных (recycle bin)
	- Table - восстановление из undo 
	- Query - сравнение текущих данных и данных в прошлом из Undo
	- Version - из Undo
	- Data archive - получить исторические данные по транзакциям (Archive log)
3. Уровень транзакций - восстанавливает подозрительные транзакции и зависимые undo/redo archive log
# Recycle Bin
Recyclebin=ON; - не работает
Flashback table <name> to before drop.
BIN$ - приставка, данные переименовываются, но не перемещаются, DBA_FREE_SPACE - не изменяется.   

Данные хранятся, пока не удалим или хватает места на диске.   
В случае восстановления данных с одинаковым именем, т для восстановления можно использовать имена системы, иначе будет восстановлена последняя удаленная.    
При недостатке места, корзина будет расширяться, если это невозможно, то удаляются элементы корзины.   
Для очищения корзины можно выполнить команду purge:
1. Purge table|index
2. Purge Tablespace [user]
3. Purge user_recyclebin (мои объекты), dba_recyclebin (вся корзина).
Удаление минуя корзину:
1. Drop table <> purge
2. Drop tablespace <> including contents
3. Drop user <> cascade - удаление юзера вместе с его объектами
*can_undrop* - могут быть восстановлены.
*show recyclebin*.  

Для включения Flashback включить:
1. Undo_managment='Auto'
2. Undo_tablespace='UNDOTBS1' - активно в данный момент только одно
3. Undo_retention=900

Ретроспективный запрос.  

Logminer - для упрощения восстановления - определяет undo sql.     

Предустановки:
1. Иметь разрешение на выполнение пакета dbms_flashback
2. Дом легирование для первичного ключа
3. Select any transaction привелегия
4. Дополнительные журналы логирования 

Опции восстановления:
1. NoconflictOnly - неконфликтующие изменения целевой транзакции будут откатаны 
2. Nocascade force - все изменения в целевой транзакции будут откатаны
3. Cascade - будут откатаны изменения в зависимых и целевой транзакциях

Отчеты об откатах - dba_flashback_txn_state, dba_fkashback_txn_report.  
