# Первая лекция
Физическое хранилище данных - файлы.  
Логическое хранилище - табличное пространство - группа файлов
На сервере - БД и инстансы.  
База данных: файлы данных.  
файлы управления - о завершениях транзакций, о расположении файлов данных и повторов, без них не работает бд   
файлы оперативных журналов повторов - информация о командах, которые были проведены для восстановления бд.  
Archived log files - копия файлов из online redo log files.  
Экземпляр - области оперативки, где временно хранится информация и набор фоновых процессов - взаимодействие между оперативкой и бд.  
БД + экземпляр = сервер оракл.  
SGA - system global area -  общая выделяемая оперативная память.  
PGA - program global area - связана с конкретным фоновым или серверным процессом - персональный кусочек памяти    
Database buffer cache - изменяемые данные, пока транзакция не закончилась    
Redo log buffer - временное хранилище информации о командах. (DML, DDL, commit)  
Shared pool - коды программ (код пакетов, функции на PLSQL) и планы выполнения запросов.   
Словарь данных - набор системных представлений (select).   
Данные из Redo log buffer будут перенесены, если:
- сделан коммит
- заполнен на 1/3
- больше 1 мб памяти заполнено
- в случае аварийного завершения
- Перед тем как DBW начнут запись данных на диск.  
## Процессы
- DBWn (несколько процессов параллельно) - записывает данные из DBC в DF. (Медленно) - при завершении транзакции или если места не осталось. Запись в журналы команд быстрая, поэтому при восстановлении базы команды выполнятся повторно. Количество сбрасываемых файлов можно прописать в файлах инициализации.
- Контрольные точки о транзакиях хранятся в заголовках и в файлах управления. Если данные при транзакции не сохранились, то благодаря табличному пространству undo бд всё вернет на свои места
- LGWR (1 процесс)
- CKPT - процесс контрольной точки - момент, когда данные из DBC перенеслись в DF - фиксация в заголовках файлов данных и контрольных файлах в виде отдельной строки
- SMON - системный монитор - начинает работу при запуске экземпляра. Считывает файлы параметров инициализации, на основе которых создает SGA, Буферы и кэши нужных размеров и запускает процесс восстановления. SMON - запускает остальные фоновые процессы + часть задач по регистрации пользователей
- PMON - process monitor - остановка всех фоновых процессов, отчистка буферов и откат не завершенных транзакций - при завершении экземпляра. Также помогает провести восстановление, когда упал пользовательский процесс: отчистка буферов и ресурсов. Мониторинг сессии и динамически регистрирует сервисы базы данных со слушателями
- Alert_log - сообщения об ошибках
- RECO - вспомогательный процесс - нужен если распределенная база данных (на нескольких серверах) для координации управления транзакциями
- При подключении к серверу на клиенте (пользователя) создается пользовательский процесс. Запрос о подключении передается службе Listener - передаем имя, пароль, нужная бд - эти данные передаются субд - на которой осуществляется проверка данных. Если ок, то создается серверный процесс - по умолчанию каждое подключение свой серверный процесс - dedicated mode. Выделяется PGA - тут хранятся приватные данные пользователя. Передается ответ листенеру, что всё ок - после создается соединение напрямую между пользователем и серверным процессом.
- Если пользователей много, то оракл заранее выделяет определенное кол-во серверных процессов. Если нет свободных серверных процессов, то пользователь становится в очередь, которыми управляют диспетчеры - shared mode. Теперь приватная информация не хранится полностью в PGA - часть передается в SGA.
- Из DF в DBC данные передает серверный процесс - т.е. читает файлы данных серверный процесс.  
Подключение к бд - взаимодействие пользовательского процесса и серверного.  
Сессия - взаимодействие между пользователем и экземпляром.   
## Также в экземпляре хранятся:
- Коды джава и виртуальных машин
- Информация по очередям, хранение информации по репликации (копирование базы данных на другую базу)
- Large pool - буффер ввода/вывода, очередей запросов, очереди ответов и тд. - используется при восстановлении и копировании

# Вторая лекция

## Работа redo log buffer   
- Есть группы, состоящие из файлов оперативных журналов повторов - member - элементы группы. Файлы полные копии друг друга. Бд не заметит их пропажу, если их будет > 0 (будет писать ошибки в alert_log). Иначе оракл не работает.   
- Если группа заполнена, то переходим к следующей группе (switch). 
- Если все группы заполнены, то возвращаемся к первой группе. No archive log - такой режим работы называется, так как существуют на ограниченном этапе времени. Количество о максимуме групп и элементов хранится в control file - двоичный файл.  
- Archive log - при каждом переключении с группы на группу создается копия одного из файлов (1 к 1) в отдельной структуре. Максимальное кол-во файлов в control file. Это делает процесс ARCn (несколько процессов параллельно). 
- Stand by destination - полная копия базы данных и после завершения транзакций информация передается в standby бд и там же тоже выполняется. Вторая бд поддерживается в том же состоянии, если что-то пошло не так, то можно переключить на stand by базу.
MMON - memory monitor - процесс отслеживает состоянии SGA и передает это на enterprise mamanger   
MMAN - memory manager - решение задач автоматизации распределения памяти.  
## Состояния DBC:
- Pinned - блок в работе - данные меняются
- Clean - когда-то в буффере что-то было, но сейчас он чистый
- Dirty - работа по изменениям закончена (commit) - но перенос в файлы данных не завершен
- Free or unused - блок никогда не использовался (не анализируется состояние буффера при записи)
## Вспомогательный файлы:
- Файлы параметров:
	- initora - текстовый файл, для применения изменений нужна перезагрузка экземпляра - изменение через текстовый файл.
	- spfile - при изменении параметров перезапуск не требуется - изменение при помощи команды alter system.
- Файлы резервных файлов
- Файл паролей - зашифрован и двоичный привилигированных учетных записей - sysdba - делает всё, sysoper - не может менять структуру бд, но может остановить и запустить бд. (Grant - выдача привилегий). Для изменения файлов паролей используется утилита oraclvp.exe
- Файл ошибок 
Размер блока в табличном пространстве system изменить нельзя.  
Набор табличных пространств образует базу данных.    
Схема - набор объектов, которые принадлежат одному пользователю.
Один файл принадлежит одному табличному пространству.   
Есть предопределенные табличные пространства. При создании БД создаются обязательно табличное пространство USERS, SYSTEM - req - таблицы словаря данных, SYSAUX - req - объекты enterprise manager, TEMP, UNDO, если установить параметр SAMPLES SCHEMA - то устанавливается табличное пространство EXAMPLES. 
